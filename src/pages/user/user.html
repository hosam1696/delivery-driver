<ion-header>

  <ion-navbar color="primary">
    <ion-title>
      <span *ngIf="orderStatus == 'accepted' || orderStatus == 'waiting'|| orderStatus == 'processing' && driverOrder?.status != 'ongoing'">
        الشركة
      </span>
      <span *ngIf="driverOrder?.status == 'ongoing' || orderStatus == 'ongoing' || orderStatus == 'completed' || orderStatus == 'received'">
        العميل
      </span>
    </ion-title>
  </ion-navbar>

</ion-header>

<ion-content padding>

  <ng-template [ngIf]="driverOrder && driverOrder.company && (orderStatus == 'accepted' || orderStatus == 'waiting' || orderStatus == 'processing')">


    <section class="avatar-section">
      <div class="avatar">
        <img [src]="fillImgSrc(driverOrder.company.logo)" alt="">
      </div>
      <h2>{{driverOrder.company.name}}</h2>
      <p class="phone-num">
          <button ion-button small clear icon-only (click)="dialNumber(driverOrder.company.phone)">
              <ion-icon name="call"></ion-icon>
          </button>
        {{driverOrder.company.phone}} 
      </p>
      <p class="notify-msg">
        <ion-icon color="danger" name="alert"></ion-icon>
        يرجى دفع مبلغ
        <b>

        {{driverOrder.total | number:'.1-2'}}
          {{'SAR' | translate}}
        </b>

        الى شركة
        {{driverOrder.company.name}}

      </p>
      <!-- <p class="small" *ngIf="orderStatus && orderStatus != 'waiting' && (orderStatus == 'processing' || orderStatus == 'ongoing')">
        {{orderStatus | translate}}
        <span *ngIf="orderStatus == 'processing'"> {{driverOrder.company.name}}</span>      
      </p> -->

    </section>


    <div class="actions">
      <div text-center>
        <button ion-button round [hidden]="orderStatus == 'waiting'" (click)="openCompanyLocation()">
          ابدأ رحلتك الان لاستلام الطلب
        </button>
      </div>
      <div text-center [hidden]="orderStatus == 'waiting'">
        <button ion-button outline round (click)="onReceiving()" >
          تم الاستلام
        </button>
        <button ion-button outline color="danger" round (click)="showModal()">
          الغاء
        </button>
      </div>
    </div>

  </ng-template>


  <ng-template [ngIf]="requestUser && orderStatus != 'accepted' &&  orderStatus != 'waiting' &&  orderStatus != 'processing'  && (driverOrder?.status == 'ongoing' || orderStatus == 'ongoing' ||  orderStatus == 'received' || orderStatus == 'completed')">

    <section class="avatar-section">
      <div class="avatar">
        <img [src]="fillImgSrc(requestUser?.logo)" alt="">
      </div>
      <h2>{{requestUser?.name}}</h2>
      <p class="phone-num">
          <button ion-button small clear icon-only *ngIf="requestUser" (click)="dialNumber(requestUser.phone)">
              <ion-icon name="call"></ion-icon>
          </button>
        {{requestUser?.phone}}
      </p>
      <p *ngIf="userData" class="notify-msg">
        <ion-icon color="danger" name="alert"></ion-icon>
        يرجى استلام مبلغ
        <b>
          {{(driverOrder.total + userData.deliveryCost - (driverOrder.moov_coupon?driverOrder.moov_coupon.amount:0)) | number:'.1-2'}}
          </b>
          ريال
         من
        {{requestUser.name}}
        <br>
        المسافة المتوقعة: {{distanceTo({lat: driverOrder.lat, lng: driverOrder.lng })}}
      </p>
      <div *ngIf="userData" class="notify-msg price-list">
          <ion-icon color="danger" name="alert"></ion-icon>

        <p>
          <span>السعر</span>:
          <span>{{driverOrder.total | number:'.1-2'}} ريال</span>
        </p>
        <p *ngIf="driverOrder.moov_coupon">
            <span>الخصم المقدم من موف</span>:
            <span>{{driverOrder.moov_coupon.amount | number:'.1-2'}} ريال</span>
        </p>
        <p>
            <span>الشحن</span>:
            <span>{{userData.deliveryCost | number:'.1-2'}} ريال</span>
          </p>
          <p>
            <span>الاجمالى</span>:
            <span>
                {{(driverOrder.total + userData.deliveryCost - (driverOrder.moov_coupon?driverOrder.moov_coupon.amount:0)) | number:'.1-2'}} ريال
            </span>
          </p>

          <br>
          <div class="payment-type">
            الدفع عند الاستلام
          </div>
      </div>
<!-- 
      <p class="small" *ngIf="driverOrder.status && (driverOrder.status == 'processing' || driverOrder.status == 'received' || driverOrder.status == 'shipping' || driverOrder.status == 'ongoing') && driverOrder.status != 'completed'">
        {{orderStatus | translate}}
      </p> -->
    </section>
    
    
    <div class="actions" *ngIf="orderStatus != 'completed'">
      <div text-center>
        <button ion-button round (click)="openOrderLocation()">
          ابدأ رحلتك الان لتوصيل الطلب
        </button>
      </div>
      <div text-center>
        <button ion-button outline round color="danger" (click)="onReturned()" [hidden]="orderStatus == 'waiting'">
          ارجاع
        </button>
        <button ion-button outline round (click)="onDeliver()" [hidden]="orderStatus == 'waiting'">
          تم التوصيل
        </button>
      </div>

      <!-- TODO: may add rating to the delivery trip -->
      <div class="action" *ngIf="orderStatus == 'completed'">
        تم التوصيل
      </div>
    </div>
  </ng-template>
</ion-content>
